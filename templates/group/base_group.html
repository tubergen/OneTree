{% extends "base_page_with_wall.html" %}

{% comment %}
    Code here is kind of sloppy now where I've hard-coded messages in 
    html plain text, and text is repeated in javascript code.
{% endcomment %}

{% block left_content %}

<div id="group-name-nav">
    {% if group.parent %}
        <h3 class="parent-word">parent</h3>
        <ul class="parent-list">
            <li>
                <span class="child-list-border"></span>&nbsp;<a class="parent-name" href="/group/{{ group.parent.url }}">{{ group.parent }}</a>
            </li>
        </ul>
    {% else %}
        <h3 class="parent-none">no parent</h3>
    {% endif %}
    {% if children %}
        {% ifequal children|length 1 %} 
            <h3 class="child-word">child</h3>
        {% else %}
            <h3 class="child-word">children</h3>
        {% endifequal %}
        <ul class="child-list">
            {% for child in children %}
                <li><span class="child-list-border"></span><a class="child-name" href="/group/{{ child.url }}">{{ child.name }}</a></li>
            {% endfor %}
        </ul>
    {% else %}
        <h3 class="child-none">no children</h3>
    {% endif %}

    {% comment %}
        <div class="grouptags">
            {% if group.tags.all %}
                <strong>Tags: </strong>
                {% for tag in group.tags.all %}
                    {{ tag.tag }} 
                {% endfor %}
            {% endif %}
        </div>
    {% endcomment %}

</div>
{% endblock %}


{% block top_title %}

    <script type="text/javascript" charset="utf-8">

    {% if user.is_authenticated %}
    $(document).ready(function() {
        {% if user_is_subscribed %}
           user_is_subscribed = true;
           $('#subscribe-button').addClass('button-subscribed');
        {% else %} 
           user_is_subscribed = false;
        {% endif %}

        // override default post behavior
        $('#subscribe-button').click(function(event) {
            if (user_is_subscribed) {
                next_text = 'subscribe';
                next_class = 'button-unsubscribed';
            }
            else {
                next_text = 'subscribed';
                next_class = 'button-subscribed';
            }
            send_subscribe_change();
            return false;
        });

        // override default post behavior
        $('#membership-button').click(req_membership);
        
    });

    function send_subscribe_change()
    {
        var url = "{{ subscribe_view_url }}";
        var data = {};
        data["group_id"] = {{ group.id }};

        $.post(url, data, function() {
            $('#subscribe-button').attr('value', next_text);
            $('#subscribe-button').removeClass('button-subscribed');
            $('#subscribe-button').addClass(next_class);
            user_is_subscribed = !user_is_subscribed;
        });
    }

    function req_membership()
    {
        var data = {"group_id":'{{group.id}}'};
        $.post("{{membership_view_url}}", data, function(data) { 
            $('#mem_status').html('Membership Pending...');
        });
        return false;
    }
    {% endif %}

</script>

<div id="group-name-blurb">
<h1 id="group-title">{{ group.name }}</h1>
{% if groupinfo.data %}
    <p style="margin-top: 0; padding-top 0;">{{ groupinfo.data }}
    {% else %}
        <p style="margin-top: 0; padding-top: 0;">This is a blurb about the group. The group should be able to put anything here that they'd like (within reason -- eg, not 30 lines of text).
        {% endif %}{% if is_admin %}<a href="/group/{{ group.name }}/info">(edit info)</a>{% endif %}</p>
</div>

<ul class="group-interaction-buttons">
    {% if user.is_authenticated %}
        <li><form method="post" action="{{ subscribe_view_url }}">{% csrf_token %}
                <input type="hidden" name="group_id" value="{{group.id}}">
            {% if user_is_subscribed %}
                <input type="submit" class="button-subscribed" id="subscribe-button" value="subscribed">
            {% else %}
                <input type="submit" class="button-unsubscribed" id="subscribe-button" value="subscribe">                                {% endif %}
        </form></li>
        <div id="mem_status">
            {% ifequal membership_status "member" %}
                <li>You're a member.</li>
            {% else %}
                {% ifequal membership_status "pending" %}
                    <li>Membership Pending...</li>
                {% else %}
                    <li><form method="post" action="{{ membership_view_url }}">{% csrf_token %}
                            <input type="hidden" name="group_id" value="{{group.id}}">
                            <input type="submit" id="membership-button" value="Request Membership">
                    </form></li>
                {% endifequal %}
            {% endifequal %}
        </div>
    {% endif %}
</ul>
{% endblock %}
