{% extends "base_page_with_wall.html" %}

{% comment %}
    Code here is kind of sloppy now where I've hard-coded messages in 
    html plain text, and text is repeated in javascript code.
{% endcomment %}

{% block head %}
    {{ block.super }}
    <link rel="stylesheet" type="text/css" href="/static/stylesheets/jquery.lightbox-0.5.css" media="screen" />
{% endblock %}

{% block left_content %}
    {% include "includes/sidebar/group_sidebar.html" %}
{% endblock %}


{% block top_title %}
    <script type="text/javascript" charset="utf-8">

    var user_is_subscribed;

    {% if user.is_authenticated %}
    $(document).ready(function() {
        {% if user_is_subscribed %}
           user_is_subscribed = true;
        {% else %} 
           user_is_subscribed = false;
        {% endif %}

        // override default POST behavior
        $('.change-subscribe').click(function(event) {
            send_subscribe_change();
            return false;
        });

        // override default POST behavior
        $('#membership-button').click(req_membership);
        
    });

    function send_subscribe_change()
    {
        var url = "{{ subscribe_view_url }}";
        var data = {};
        data["group_id"] = {{ group.id }};

        $.post(url, data, function() {
            user_is_subscribed = !user_is_subscribed;
            if (user_is_subscribed) {
               $('#unsubscribed-content').hide();
               $('#subscribed-content').show();
            }
            else {
               $('#unsubscribed-content').show();
               $('#subscribed-content').hide();
            }

        });
    }

    function req_membership()
    {
        var data = {"group_id":'{{group.id}}'};
        $.post("{{membership_view_url}}", data, function(data) { 
            $('#mem-status').html('Membership Pending...');
        });
        return false;
    }
    {% endif %}

</script>

<div id="group-name-blurb">
<h1 id="group-title">{{ group.name }}</h1>
{% if groupinfo.data %}
    <p style="margin-top: 0; padding-top 0;">{{ groupinfo.data }}
    {% else %}
        <p style="margin-top: 0; padding-top: 0;">This is a blurb about the group. The group should be able to put anything here that they'd like (within reason -- eg, not 30 lines of text).
        {% endif %}{% if is_admin %}{% if not is_groupinfo_page %}(<a href="/group/{{ group.url }}/info/edit">edit info</a>){% endif %}{% endif %}</p>
</div>

<ul class="group-interaction-buttons">
    {% if user.is_authenticated %}
        <li><form method="post" action="{{ subscribe_view_url }}">{% csrf_token %}
            <input type="hidden" name="group_id" value="{{group.id}}">
            
	    <div id="subscribed-content" {% if not user_is_subscribed %} style="display:none" {% endif %}>
	        <span class="status-text"> You are currently subscribed.</span>
		<span class="change-span">(<button type="submit" class="button-link change-subscribe" value="subscribed">unsubscribe</button>)</span>
	    </div>

	    <div id="unsubscribed-content" {% if user_is_subscribed %} style="display:none" {% endif %}>
                <input type="submit" class="button-unsubscribed change-subscribe" id="subscribe-button" value="subscribe">                                
	    </div>

        </form></li>

        <div id="mem-status">

            {% ifequal membership_status "member" %}
                <li>You're a member.</li>
            {% else %}
                {% ifequal membership_status "pending" %}
                    <li>Membership Pending...</li>
                {% else %}
                    <li><form method="post" action="{{ membership_view_url }}">{% csrf_token %}
                            <input type="hidden" name="group_id" value="{{group.id}}">
                            <input type="submit" id="membership-button" value="Request Membership">
                    </form></li>
                {% endifequal %}
            {% endifequal %}	    
        </div>
	{% if is_superadmin %}
    	    <li>You're the group's superadmin.</li>
	{% else %}
   	    {% if is_admin %}
                <li>You're a group admin.</li>
	    {% endif %}
	{% endif %}
    {% endif %}
</ul>
{% endblock %}
