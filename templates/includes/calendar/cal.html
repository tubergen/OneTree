
<link rel="stylesheet" href="/static/datepicker/jquery.datepick.css" type="text/css" charset="utf-8"/> 

<link rel="stylesheet" href="/static/datepicker/css/ui.theme.css" type="text/css" charset="utf-8"/>
<link rel="stylesheet" href="/static/datepicker/css/ui.core.css" type="text/css" charset="utf-8"/>
<link rel="stylesheet" href="/static/datepicker/css/ui.datepicker.css" type="text/css" charset="utf-8"/>


<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.resizable.css" type="text/css" charset="utf-8"/> 
<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.selectable.css" type="text/css" charset="utf-8"/> 
<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.accordion.css" type="text/css" charset="utf-8"/> 
<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.autocomplete.css" type="text/css" charset="utf-8"/> 
<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.button.css" type="text/css" charset="utf-8"/> 
<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.dialog.css" type="text/css" charset="utf-8"/> 
<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.slider.css" type="text/css" charset="utf-8"/> 
<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.tabs.css" type="text/css" charset="utf-8"/> 

<link rel="stylesheet" href="/static/jquery_ui/themes/base/jquery.ui.progressbar.css" type="text/css" charset="utf-8"/>  

<link rel="stylesheet" href="/static/datepicker/ui-cupertino.datepick.css" type="text/css" charset="utf-8"/> 

<script type="text/javascript" charset="utf-8" src="/static/datepicker/jquery.datepick.js"></script>
<script type="text/javascript" charset="utf-8" src="/static/datepicker/jquery.datepick.ext.js"></script>

<script type="text/javascript"> 

   $(function() {
      create_picker();
   }); 

   var cal_click_count = 0;

   function showHover(date, selectable) { 

      if (cal_click_count == 0)
         $('.datepick-status').html('Range Start: ' + format_amer_date(date));
      else if (cal_click_count == 1)
         $('.datepick-status').html('Range End: ' + format_amer_date(date));
      else {}

   }

   function create_picker() {
      $('#inlineDatepicker').datepick({rangeSelect: true, 
                                       onSelect: filter_date,
                                       showOtherMonths: true,
                                       selectOtherMonths: true,
                                       fixedWeeks: true,
                                       onShow: $.datepick.hoverCallback(showHover),
                                       renderer: $.datepick.themeRollerRenderer,
                                       showTrigger: '#cal_img'
                                       });
   }   

   var date0_str;
   var date1_str;
   var range_selected = false;

   function filter_date(dates) {

      date0_str = format_amer_date(dates[0]);
      date1_str = format_amer_date(dates[1]);

      cal_click_count++;

      if (cal_click_count == 2)
      {
         range_selected = true;
         cal_click_count = 0;
      }

      // end of interval isn't inclusive in django code, so need to do this
      var dates1 = new Date(dates[1].getTime());
      dates1.setDate(dates1.getDate() + 1);

      filters["start_date"] = format_date(dates[0]);
      filters["end_date"] = format_date(dates1);

      apply_filter('this_date_only');

   }

   /* currently unused */
   function reset_datepicker() {
      $('#inlineDatepicker').datepick('destroy');
      create_picker();
      delete filters["start_date"];
      delete filters["end_date"];
      remove_filter('this_date_only');
      cal_click_count = 0;
      range_selected = false;
      $('.datepick-status').html('Select a date range');
   }

   function format_amer_date(date) {
      m = date.getMonth() + 1; /* + 1 because jan = 0, dec = 11 */
      d = date.getDate();
      y = date.getFullYear().toString().slice(2);

      if (m < 10)
         m = '0' + m;
      if (d < 10)
         d = '0' + d;

      return m + '/' + d + '/' + y;
   }

   function format_date(date) {
      m = date.getMonth() + 1; /* + 1 because jan = 0, dec = 11 */
      d = date.getDate();
      y = date.getFullYear();

      if (m < 10)
         m = '0' + m;
      if (d < 10)
         d = '0' + d;

      return y + '-' + m + '-' + d;
   }

   $(document).ready(function() {
      $('#inlineDatepicker').hover(function() {}, function() { 
         if (range_selected)
            $('.datepick-status').html(date0_str + ' - ' + date1_str);
         else
            $('.datepick-status').html('Select a date range');
      });
      // populate these here so they don't appear for people without javascript
      $('.datepick-status').html('Select a date range');
      $('.cal-reset').html('reset');
   });
</script> 

{# actual html for calendar #}
      <div style="display:none">
         <img id="cal_img" alt="Popup" src="/static/datepicker/calendar-blue.gif">
      </div>
      <input type="text" id="inlineDatepicker" size="20" value="Select a date range">
